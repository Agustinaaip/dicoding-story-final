const CACHE_NAME="DicodingStory-V1",urlsToCache=["/","/index.html","/manifest.json","/images/favicon-16x16.png","/images/icon-192x192.png","/images/icon-512x512.png"];self.addEventListener("install",(e=>{console.log("Service Worker: Installed"),e.waitUntil(caches.open(CACHE_NAME).then((e=>(console.log("Caching app shell"),e.addAll(urlsToCache))))),self.skipWaiting()})),self.addEventListener("activate",(e=>{console.log("Service Worker: Activated"),e.waitUntil(caches.keys().then((e=>Promise.all(e.filter((e=>e!==CACHE_NAME)).map((e=>(console.log("Deleting old cache:",e),caches.delete(e))))))).then((()=>clients.claim())))})),self.addEventListener("fetch",(e=>{e.respondWith(caches.match(e.request).then((t=>{if(t)return t;const i=e.request.clone();return fetch(i).then((t=>{if(!t||200!==t.status||"basic"!==t.type)return t;const i=t.clone();return(e.request.url.includes("/assets/")||e.request.url.includes("/styles/")||e.request.url.includes(".js")||e.request.url.includes(".html"))&&caches.open(CACHE_NAME).then((t=>{t.put(e.request,i)})),t})).catch((()=>{if("navigate"===e.request.mode)return caches.match("/index.html")}))})))})),self.addEventListener("push",(e=>{console.log("Service Worker: Push Received");let t={};try{t=e.data.json()}catch(i){t={title:"Notifikasi Baru",body:e.data?e.data.text():"Tidak ada detail",icon:"/images/icon-192x192.png"}}const i=t.title||"Dicoding Story",n={body:t.body||"Ada pembaruan baru untuk Anda",icon:t.icon||"/images/icon-192x192.png",badge:"/images/badge-72x72.png",vibrate:[100,50,100,50,100],data:{url:t.url||"/",dateOfArrival:Date.now(),primaryKey:1}};e.waitUntil(self.registration.showNotification(i,n))})),self.addEventListener("notificationclick",(e=>{console.log("Service Worker: Notification Clicked"),e.notification.close();const t=e.notification.data?.url||"/";e.waitUntil(clients.matchAll({type:"window",includeUncontrolled:!0}).then((e=>{e.some((e=>e.url===t&&e.focus()))||clients.openWindow(t)})))})),self.addEventListener("notificationclose",(e=>{console.log("Service Worker: Notification Closed",e)}));